#include "LowPassFilter.h"

static double filter_taps[LOWPASSFILTER_TAP_NUM] = {
  0.0026860394609052314,
  0.0030072172720754585,
  0.004269075542858579,
  0.005462166798181718,
  0.006350988282626899,
  0.006666522632630727,
  0.0061397843388047045,
  0.004547287824441889,
  0.0017552512405571703,
  -0.0022415580399810795,
  -0.007286471974378047,
  -0.013038404778768418,
  -0.018982008833152292,
  -0.024461499581270967,
  -0.02872506711629734,
  -0.0310023749039319,
  -0.030596694338697952,
  -0.026955891929341773,
  -0.019777027045695745,
  -0.009050259677514457,
  0.0048951300408898455,
  0.021394413991156516,
  0.039484234362248904,
  0.05797594806663111,
  0.07555755679136916,
  0.09091249047580542,
  0.10285138216197934,
  0.11042364599455533,
  0.1130176407637768,
  0.11042364599455533,
  0.10285138216197934,
  0.09091249047580542,
  0.07555755679136916,
  0.05797594806663111,
  0.039484234362248904,
  0.021394413991156516,
  0.0048951300408898455,
  -0.009050259677514457,
  -0.019777027045695745,
  -0.026955891929341773,
  -0.030596694338697952,
  -0.0310023749039319,
  -0.02872506711629734,
  -0.024461499581270967,
  -0.018982008833152292,
  -0.013038404778768418,
  -0.007286471974378047,
  -0.0022415580399810795,
  0.0017552512405571703,
  0.004547287824441889,
  0.0061397843388047045,
  0.006666522632630727,
  0.006350988282626899,
  0.005462166798181718,
  0.004269075542858579,
  0.0030072172720754585,
  0.0026860394609052314
};

void LowPassFilter_init(LowPassFilter* f) {
  int i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void LowPassFilter_put(LowPassFilter* f, double input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOWPASSFILTER_TAP_NUM)
    f->last_index = 0;
}

double LowPassFilter_get(LowPassFilter* f) {
  double acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOWPASSFILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOWPASSFILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}

